<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>SDM ‚Äì Sem Desperd√≠cio de Materiais</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  /* Reset e corpo */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; font-family: 'Roboto', sans-serif; background: #f9f9f9; color: #333;
    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    display: flex; justify-content: center; align-items: center;
    height: 100vh;
  }

  /* Container simulando tela celular */
  #app-container {
    display: flex;
    flex-direction: column;
    height: 90vh;
    width: 380px;
    max-width: 100vw;
    background: white;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    overflow: hidden;
  }

  /* Tela de entrada */
  #login-screen {
    display: flex;
    flex-direction: column;
    flex: 1;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    background: linear-gradient(135deg, #34495e, #e67e22);
    color: white;
    position: relative;
  }
  #login-screen .logo-container {
    background: white;
    border-radius: 50%;
    width: 140px;
    height: 140px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 2rem;
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
  }
  #login-screen .logo-text {
    font-size: 3.5rem;
    font-weight: 900;
    background: linear-gradient(45deg, #e67e22, #2980b9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    user-select: none;
  }
  #login-screen h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    font-weight: 700;
  }
  #login-screen p {
    margin-top: 0; font-size: 1.2rem; margin-bottom: 2.5rem;
    color: rgba(255,255,255,0.85);
    font-weight: 600;
  }
  #btn-login {
    background-color: white;
    border: none;
    color: #e67e22;
    padding: 1rem 3rem;
    font-size: 1.3rem;
    border-radius: 30px;
    cursor: pointer;
    font-weight: 900;
    transition: background-color 0.3s ease, color 0.3s ease;
    box-shadow: 0 4px 8px rgba(230,126,34,0.6);
  }
  #btn-login:hover {
    background-color: #d35400;
    color: white;
    box-shadow: 0 6px 12px rgba(211,84,0,0.8);
  }

  /* Container principal ap√≥s login */
  #main-app {
    display: none; /* Inicialmente oculto */
    flex-direction: row;
    height: 100%;
    width: 100%;
  }

  /* Menu lateral estilo celular */
  #side-menu {
    width: 90px;
    background: #2c3e50;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 1rem;
    user-select: none;
  }

  #side-menu button {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.3rem;
    margin: 1rem 0;
    padding: 0.25rem;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 100%;
    transition: background-color 0.3s ease;
    border-left: 4px solid transparent;
  }
  #side-menu button span {
    font-size: 0.75rem;
    white-space: nowrap;
  }
  #side-menu button:hover,
  #side-menu button.active {
    background-color: #e67e22;
    color: white;
    border-left-color: white;
  }

  /* Conte√∫do principal - √°rea das telas */
  #content-container {
    flex-grow: 1;
    padding: 1rem 1.5rem;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #e67e22 #f0f0f0;
  }
  #content-container::-webkit-scrollbar {
    width: 6px;
  }
  #content-container::-webkit-scrollbar-thumb {
    background-color: #e67e22;
    border-radius: 3px;
  }
  #content-container::-webkit-scrollbar-track {
    background-color: #f0f0f0;
  }

  h2 {
    color: #e67e22; margin-bottom: 1rem; font-size: 1.6rem;
  }
  label {
    display: block; margin-bottom: 0.3rem; font-weight: 700;
    color: #34495e;
    font-size: 0.9rem;
  }
  input[type=text], input[type=number], input[type=date], select, textarea {
    width: 100%; padding: 0.55rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 7px;
    font-size: 1rem; box-sizing: border-box;
    font-family: 'Roboto', sans-serif;
  }

  input[type=file] {
    margin-bottom: 1rem;
  }

  button.primary {
    background-color: #e67e22; border: none; color: white;
    padding: 0.8rem 1.6rem; font-size: 1.1rem; font-weight: 700;
    border-radius: 30px; cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button.primary:hover {
    background-color: #d35400;
  }
  button[disabled] {
    background-color: #bdc3c7 !important; cursor: not-allowed;
  }

  table {
    width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem;
  }
  th, td {
    padding: 0.55rem; border-bottom: 1px solid #ddd; text-align: left;
  }
  th {
    background: #ecf0f1;
  }

  .alert {
    background: #f39c12; color: white; padding: 0.75rem 1rem;
    margin: 1rem 0; border-radius: 7px;
    font-weight: 700; font-size: 1rem;
  }

  /* Navega√ß√£o interna (aba) */
  section {
    display: none;
  }
  section.active {
    display: block;
  }

  /* Responsive table mobile */
  @media (max-width: 380px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    tr {
      margin-bottom: 0.8rem;
      border-bottom: 2px solid #ecf0f1;
    }
    td {
      padding-left: 50%;
      position: relative;
      text-align: right;
    }
    td:before {
      position: absolute;
      top: 0.6rem;
      left: 0.6rem;
      width: 45%;
      white-space: nowrap;
      font-weight: 700;
      text-align: left;
      color: #34495e;
      font-size: 0.85rem;
    }
    td:nth-of-type(1):before { content: "Material"; }
    td:nth-of-type(2):before { content: "Quantidade"; }
    td:nth-of-type(3):before { content: "Data"; }
    td:nth-of-type(4):before { content: "Respons√°vel"; }
    td:nth-of-type(5):before { content: "Local/Obs"; }
  }

  /* Menu texto menor e icones */
  .icon-label {
    font-size: 0.7rem;
  }

  /* Scroll suave para navega√ß√£o */
  html {
    scroll-behavior: smooth;
  }
</style>
</head>
<body>
<div id="app-container">

  <!-- Tela de entrada / login -->
  <div id="login-screen">
    <div class="logo-container" aria-label="Logo SDM">
      <span class="logo-text" aria-hidden="true">SDM</span>
    </div>
    <h1>SDM</h1>
    <p>Sem Desperd√≠cio de Materiais</p>
    <button id="btn-login" aria-label="Entrar no aplicativo">Entrar</button>
  </div>

  <!-- Aplicativo principal ap√≥s login -->
  <div id="main-app">
    <!-- Menu lateral -->
    <nav id="side-menu" aria-label="Menu Principal">
      <button id="btn-cadastro" class="active" aria-controls="cadastro-section" aria-selected="true" role="tab" tabindex="0" title="Cadastro de Materiais">
        üì•<span class="icon-label">Cadastro</span>
      </button>
      <button id="btn-uso" aria-controls="uso-section" aria-selected="false" role="tab" tabindex="-1" title="Registro de Uso">
        üõ†<span class="icon-label">Uso</span>
      </button>
      <button id="btn-estoque" aria-controls="estoque-section" aria-selected="false" role="tab" tabindex="-1" title="Estoque Atualizado">
        üì¶<span class="icon-label">Estoque</span>
      </button>
      <button id="btn-relatorios" aria-controls="relatorios-section" aria-selected="false" role="tab" tabindex="-1" title="Relat√≥rios">
        üìä<span class="icon-label">Relat√≥rios</span>
      </button>
      <button id="btn-config" aria-controls="config-section" aria-selected="false" role="tab" tabindex="-1" title="Configura√ß√µes">
        ‚öô<span class="icon-label">Config</span>
      </button>
      <button id="btn-calculo" aria-controls="calculo-section" aria-selected="false" role="tab" tabindex="-1" title="C√°lculo de Materiais">
        üìê<span class="icon-label">C√°lculo</span>
      </button>
    </nav>

    <!-- Conte√∫do das abas -->
    <main id="content-container">

      <section id="cadastro-section" class="active" role="tabpanel" tabindex="0" aria-label="Cadastro de Materiais">
        <h2>Cadastro de Materiais</h2>
        <form id="form-cadastro">
          <label for="material-nome">Nome do Material</label>
          <input type="text" id="material-nome" name="nome" required="" maxlength="50" placeholder="Ex: Cimento">

          <label for="material-foto">Foto do Material</label>
          <input type="file" id="material-foto" name="foto" accept="image/*">

          <label for="material-quantidade">Quantidade Recebida</label>
          <input type="number" id="material-quantidade" name="quantidade" required="" min="1" placeholder="Ex: 100">

          <label for="material-data">Data de Entrada</label>
          <input type="date" id="material-data" name="dataEntrada" required="">

          <label for="material-responsavel">Respons√°vel pelo Recebimento</label>
          <input type="text" id="material-responsavel" name="responsavelEntrada" required="" placeholder="Nome do respons√°vel" maxlength="50">

          <label for="material-local">Local da Obra</label>
          <input type="text" id="material-local" name="localObra" required="" placeholder="Ex: Obra Centro" maxlength="100">

          <button type="submit" class="primary">‚ûï Cadastrar Material</button>
        </form>
      </section>

      <section id="uso-section" role="tabpanel" tabindex="0" aria-label="Registro de Uso de Materiais">
        <h2>Registro de Uso de Materiais</h2>
        <form id="form-uso">
          <label for="uso-material">Material</label>
          <select id="uso-material" name="material" required="">
            <option value="">Selecione um material</option>
          </select>

          <label for="uso-quantidade">Quantidade Usada</label>
          <input type="number" id="uso-quantidade" name="quantidade" required="" min="1" placeholder="Ex: 20">

          <label for="uso-local">Onde Foi Usado</label>
          <input type="text" id="uso-local" name="local" required="" placeholder="Local ou atividade" maxlength="100">

          <label for="uso-responsavel">Respons√°vel pelo Uso</label>
          <input type="text" id="uso-responsavel" name="responsavel" required="" maxlength="50" placeholder="Nome do respons√°vel">

          <label for="uso-data">Data de Uso</label>
          <input type="date" id="uso-data" name="dataUso" required="">

          <button type="submit" class="primary">‚úÖ Registrar Uso</button>
        </form>
      </section>

      <section id="estoque-section" role="tabpanel" tabindex="0" aria-label="Estoque Atualizado">
        <h2>Estoque Atualizado</h2>
        <div id="alert-baixa-quantidade" aria-live="polite" class="alert" style="display:none;"></div>
        <table aria-label="Tabela de materiais em estoque">
          <thead>
            <tr>
              <th>Material</th>
              <th>Quantidade Dispon√≠vel</th>
              <th>Local da Obra</th>
              <th>√öltima Entrada</th>
              <th>√öltimo Uso</th>
            </tr>
          </thead>
          <tbody id="estoque-tbody">
          </tbody>
        </table>
        <h3>Hist√≥rico de Entrada e Sa√≠da</h3>
        <table aria-label="Hist√≥rico de entradas e sa√≠das">
          <thead>
            <tr>
              <th>Material</th>
              <th>Tipo</th>
              <th>Quantidade</th>
              <th>Data</th>
              <th>Respons√°vel</th>
              <th>Local/Obs</th>
            </tr>
          </thead>
          <tbody id="historico-tbody">
          </tbody>
        </table>
      </section>

      <section id="relatorios-section" role="tabpanel" tabindex="0" aria-label="Relat√≥rios simples">
        <h2>Relat√≥rios</h2>
        <button id="exportar-pdf" class="primary" title="Exportar Relat√≥rios em PDF">üìÑ Exportar em PDF</button>

        <h3>Resumo do Uso Semanal</h3>
        <div id="relatorio-semanal"></div>

        <h3>Materiais Mais Desperdi√ßados</h3>
        <div id="relatorio-desperdicio"></div>

        <h3>Compara√ß√£o entre Entrada e Uso</h3>
        <div id="relatorio-comparacao"></div>
      </section>

      <section id="config-section" role="tabpanel" tabindex="0" aria-label="Configura√ß√µes do Usu√°rio">
        <h2>Configura√ß√µes</h2>
        <label for="usuario-role">Selecione o Perfil do Usu√°rio:</label>
        <select id="usuario-role">
          <option value="administrador">Administrador (Engenheiro/Gestor)</option>
          <option value="encarregado">Encarregado da Obra</option>
          <option value="ajudante">Ajudante/Colaborador</option>
        </select>
        <p>Perfil atual: <span id="perfil-atual">Administrador</span></p>
      </section>

      <section id="calculo-section" role="tabpanel" tabindex="0" aria-label="C√°lculo de Uso de Materiais">
        <h2>Calculadora de Materiais</h2>
        <form id="form-calculo">
          <label for="calc-area">√Årea da Obra (em m¬≤)</label>
          <input type="number" id="calc-area" name="area" min="1" required placeholder="Ex: 70">

          <label for="calc-material">Nome do Material</label>
          <input type="text" id="calc-material" name="material" required placeholder="Digite o nome, ex: cimento">

          <label for="calc-quantidade">Quantidade por m¬≤</label>
          <input type="number" id="calc-quantidade" name="quantidade" required placeholder="Ex: 0.03">

          <button type="submit" class="primary">üìè Calcular</button>
        </form>
        <div id="calc-resultado" class="alert" style="display:none; margin-top:1rem;"></div>
      </section>

    </main>
  </div>
</div>

<script>
  (function(){
    const STORAGE_MATERIAIS = 'sdm_materiais';
    const STORAGE_USOS = 'sdm_usos';
    const STORAGE_USER_ROLE = 'sdm_user_role';

    // Element refs
    const loginScreen = document.getElementById('login-screen');
    const btnLogin = document.getElementById('btn-login');
    const mainApp = document.getElementById('main-app');

    const sideMenu = document.getElementById('side-menu');
    const menuButtons = {
      calculo: document.getElementById('btn-calculo'),
      cadastro: document.getElementById('btn-cadastro'),
      uso: document.getElementById('btn-uso'),
      estoque: document.getElementById('
